$("#deptSelect").tap(function(){deptSelect()});function deptSelect(){var f=$("#deptTitle").html();var e=$("#deptTitle").attr("data-dept");var a=$("#diseaseTitle").html();var d=$("#diseaseTitle").attr("data-disease");var b=$("#cityTitle").html();var g=$("#cityTitle").attr("data-city");var c='<div id="findDoc_section">'+'<header class="bg-green">'+'<nav class="left">'+'<a href="'+$homeView+'">'+'<div class="pl5">'+'<img src="../../themes/m5/images/back.png" class="w11p">'+"</div>"+"</a>"+"</nav>"+'<h1 class="title">找名医</h1>'+'<nav class="right">'+'<a onclick="javascript:history.go(0)">'+'<img src="../../themes/m5/images/refresh.png" class="w24p">'+"</a>"+"</nav>"+"</header>"+'<nav id="findDoc_nav" class="header-secondary bg-white">'+'<div class="grid w100 color-black font-s16 color-black6">'+'<div id="deptSelect" data-target="closePopup" class="col-1 w33 br-gray bb-gray grid middle grayImg">'+'<span id="deptTitle" data-dept="'+e+'">'+f+'</span><img src="../../themes/m5/images/lowerTriangleGray.png">'+'<div style="position: fixed;top: 74px; left:14.54%;"><img id="remindImg" class="w14p" src="../../themes/m5/images/upperTriangleWhite.png"></div>'+"</div>"+'<div id="diseaseSelect" data-target="closePopup" class="col-1 w33 br-gray bb-gray grid middle grayImg">'+'<span id="diseaseTitle" data-disease="'+d+'">'+a+'</span><img src="../../themes/m5/images/lowerTriangleGray.png">'+"</div>"+'<div id="citySelect" data-target="closePopup" class="col-1 w33 bb-gray grid middle grayImg">'+'<span id="cityTitle" data-city="'+g+'">'+b+'</span><img src="../../themes/m5/images/lowerTriangleGray.png">'+"</div>"+"</div>"+"</nav>"+'<article id="findDoc_article" class="active" style="position:static;">'+$deptHtml+"</article>"+"</div>";J.popup({html:c,pos:"top",showCloseBtn:false});$(".aDept").click(function(i){i.preventDefault();var h=$(this).attr("data-dept");if(h!=1){$("#remindImg").attr("src","../../themes/m5/images/upperTriangleGray.png")}else{$("#remindImg").attr("src","../../themes/m5/images/upperTriangleWhite.png")}$(".aDept").each(function(){if(h==$(this).attr("data-dept")){$(this).addClass("bg-white")}else{$(this).removeClass("bg-white")}});$(".bDept").each(function(){if(h==$(this).attr("data-dept")){$(this).removeClass("hide")}else{$(this).addClass("hide")}})});$(".cDept").click(function(i){i.preventDefault();$deptId=$(this).attr("data-dept");$deptName=$(this).html();$condition["disease_sub_category"]=$deptId;$condition["disease"]="";$condition["disease_name"]="";$condition["city"]="";$condition["page"]=1;setTimeout(function(){J.closePopup()},100);var h=$requestDoc+setUrlCondition()+"&getcount=1";J.showMask();$.ajax({url:h,success:function(j){readyDoc(j);$deptName=$deptName.length>4?$deptName.substr(0,3)+"...":$deptName;$("#deptTitle").html($deptName);$("#deptTitle").attr("data-dept",$deptId);$("#diseaseTitle").html("疾病");$("#diseaseTitle").attr("data-disease","");$("#cityTitle").html("地区");$("#cityTitle").attr("data-disease","");setLocationUrl();$("#findDoc_article").scrollTop(0)}})})}$("#diseaseSelect").tap(function(){var h=$("#deptTitle").html();var b=$("#deptTitle").attr("data-dept");var a=$("#diseaseTitle").html();var e=$("#diseaseTitle").attr("data-disease");var i=$("#cityTitle").html();var g=$("#cityTitle").attr("data-city");var f="";if(b==""){deptSelect();return}$.ajax({url:$requestDisease+"/"+b,success:function(j){f=d(j);c(f)}});function d(m){var l=m.results;var j='<div id="diseaseList" class="grid color-black" data-scroll="true" style="margin-top:93px;height:315px;">'+'<ul class="list w100">';if(l){var n=l.disease;if(n.length>0){for(var k=0;k<n.length;k++){j+='<li class="aDisease" data-disease="'+n[k].id+'">'+n[k].name+"</li>"}}}j+="</ul></div>";return j}function c(j){var k='<div id="findDoc_section">'+'<header class="bg-green">'+'<nav class="left">'+'<a href="'+$homeView+'">'+'<div class="pl5">'+'<img src="../../themes/m5/images/back.png" class="w11p">'+"</div>"+"</a>"+"</nav>"+'<h1 class="title">找名医</h1>'+'<nav class="right">'+'<a onclick="javascript:history.go(0)">'+'<img src="../../themes/m5/images/refresh.png" class="w24p">'+"</a>"+"</nav>"+"</header>"+'<nav id="findDoc_nav" class="header-secondary bg-white">'+'<div class="grid w100 color-black font-s16 color-black6">'+'<div id="deptSelect" data-target="closePopup" class="col-1 w33 br-gray bb-gray grid middle grayImg">'+'<span id="deptTitle" data-dept="'+b+'">'+h+'</span><img src="../../themes/m5/images/lowerTriangleGray.png">'+"</div>"+'<div id="diseaseSelect" data-target="closePopup" class="col-1 w33 br-gray bb-gray grid middle grayImg">'+'<span id="diseaseTitle" data-disease="'+e+'">'+a+'</span><img src="../../themes/m5/images/lowerTriangleGray.png">'+'<div style="position: fixed;top: 74px; left:47.75%;"><img class="w14p" src="../../themes/m5/images/upperTriangleWhite.png"></div>'+"</div>"+'<div id="citySelect" data-target="closePopup" class="col-1 w33 bb-gray grid middle grayImg">'+'<span id="cityTitle" data-city="'+g+'">'+i+'</span><img src="../../themes/m5/images/lowerTriangleGray.png">'+"</div>"+"</div>"+"</nav>"+'<article id="findDoc_article" class="active" style="position:static;">'+j+"</article>"+"</div>";J.popup({html:k,pos:"top",showCloseBtn:false});$(".aDisease").click(function(m){m.preventDefault();$diseaseNameB=$(this).html();$diseaseIdB=$(this).attr("data-disease");$deptId=$("#deptTitle").attr("data-dept");$deptName=$("#deptTitle").html();$condition["disease_name"]="";$condition["city"]="";$condition["disease"]=$diseaseIdB;$condition["page"]=1;setTimeout(function(){J.closePopup()},100);var l=$requestDoc+setUrlCondition()+"&getcount=1";J.showMask();$.ajax({url:l,success:function(n){readyDoc(n);$diseaseNameB=$diseaseNameB.length>4?$diseaseNameB.substr(0,3)+"...":$diseaseNameB;$("#deptTitle").html($deptName);$("#diseaseTitle").html($diseaseNameB);$("#diseaseTitle").attr("data-disease",$diseaseIdB);$("#cityTitle").html("地区");$("#cityTitle").attr("data-city","");setLocationUrl();$("#findDoc_article").scrollTop(0)}})})}});$("#citySelect").tap(function(){var f=$("#deptTitle").html();var e=$("#deptTitle").attr("data-dept");var a=$("#diseaseTitle").html();var d=$("#diseaseTitle").attr("data-disease");var b=$("#cityTitle").html();var g=$("#cityTitle").attr("data-city");var c='<div id="findDoc_section">'+'<header class="bg-green">'+'<nav class="left">'+'<a href="'+$homeView+'">'+'<div class="pl5">'+'<img src="../../themes/m5/images/back.png" class="w11p">'+"</div>"+"</a>"+"</nav>"+'<h1 class="title">找名医</h1>'+'<nav class="right">'+'<a onclick="javascript:history.go(0)">'+'<img src="../../themes/m5/images/refresh.png" class="w24p">'+"</a>"+"</nav>"+"</header>"+'<nav id="findDoc_nav" class="header-secondary bg-white">'+'<div class="grid w100 color-black font-s16 color-black6">'+'<div id="deptSelect" data-target="closePopup" class="col-1 w33 br-gray bb-gray grid middle grayImg">'+'<span id="deptTitle" data-dept="'+e+'">'+f+'</span><img src="../../themes/m5/images/lowerTriangleGray.png">'+"</div>"+'<div id="diseaseSelect" data-target="closePopup" class="col-1 w33 br-gray bb-gray grid middle grayImg">'+'<span id="diseaseTitle" data-disease="'+d+'">'+a+'</span><img src="../../themes/m5/images/lowerTriangleGray.png">'+"</div>"+'<div id="citySelect" data-target="closePopup" class="col-1 w33 bb-gray grid middle grayImg">'+'<span id="cityTitle" data-city="'+g+'">'+b+'</span><img src="../../themes/m5/images/lowerTriangleGray.png">'+'<div style="position: fixed;top: 74px; left:81.6%;"><img class="w14p" src="../../themes/m5/images/upperTriangleWhite.png"></div>'+"</div>"+"</div>"+"</nav>"+'<article id="findDoc_article" class="active" style="position:static;">'+$cityHtml+"</article>"+"</div>";J.popup({html:c,pos:"top",showCloseBtn:false});$(".aCity").click(function(i){i.preventDefault();var h=$(this).attr("data-city");$(".aCity").each(function(){if(h==$(this).attr("data-city")){$(this).addClass("bg-white")}else{$(this).removeClass("bg-white")}});$(".bCity").each(function(){if(h==$(this).attr("data-city")){$(this).removeClass("hide")}else{$(this).addClass("hide")}})});$(".cCity").click(function(i){i.preventDefault();$deptId=$("#deptTitle").attr("data-dept");$diseaseId=$("#diseaseTitle").attr("data-disease");$cityId=$(this).attr("data-city");$cityName=$(this).html();$condition["disease"]=$diseaseId;$condition["disease_name"]="";$condition["city"]=$cityId;$condition["page"]=1;setTimeout(function(){J.closePopup()},100);var h=$requestDoc+setUrlCondition()+"&getcount=1";J.showMask();$.ajax({url:h,success:function(j){readyDoc(j);$("#cityTitle").html($cityName);$("#cityTitle").attr("data-city",$cityId);setLocationUrl();$("#findDoc_article").scrollTop(0)}})})});function readyDoc(d){var e=d.results;var a='<div class="pt20"></div>';if(e){if(e.length>0){for(var f=0;f<e.length;f++){var c=f==0?"":"bt-gray2";var g=(e[f].desc==""||e[f].desc==null)?"暂无信息":e[f].desc;g=g.length>40?g.substr(0,40)+"...":g;a+="<div>"+'<a href="'+$requestDoctorView+"/"+e[f].id+'" data-target="link">'+'<div class="grid pl15 pr15 '+c+'">'+'<div class="col-1 w25 pt10">'+'<div class="w60p h60p br50" style="overflow:hidden;"><img class="imgDoc" src="'+e[f].imageUrl+'"></div>';var j="";if(e[f].aTitle!="无"){j=e[f].aTitle}a+="</div>"+'<div class="ml10 col-1 w75">'+'<div class="grid">'+'<div class="col-0 pt10 color-black2 font-s16">'+e[f].name+'<span class="ml5">'+j+"</span></div>"+'<div class="col-1 grid"><div class="col-1"></div>';if(e[f].isServiceId==2){a+='<div class="col-0 yzIcon font-s12">义诊</div>'}if(e[f].isContracted==1){a+='<div class="col-0 signIcon ml10 font-s12">签约</div>'}a+="</div></div>";if(e[f].hpDeptName==""||e[f].hpDeptName==null){if(e[f].mTitle==""||e[f].mTitle==null){a+=""}else{a+='<div class="mt5 color-black6">'+e[f].mTitle+"</div>"}}else{if(e[f].mTitle==""||e[f].mTitle==null){a+='<div class="color-black6">'+e[f].hpDeptName+"</div>"}else{a+='<div class="color-black6">'+e[f].hpDeptName+'<span class="ml5">'+e[f].mTitle+"</span></div>"}}if(e[f].hpName!=""&&e[f].hpName!=null){a+='<div class="color-black6">'+e[f].hpName+"</div>"}a+="</div>"+"</div>"+"</a>";a+='<div class="pl15 pr15 pt5 pb10 color-black bb-gray2">'+'<span class="color-orange font-w800">擅长:</span>'+g+"</div>"+'<div class="bb10-gray "></div>'+"</div>"}}}else{a+='<div class="grid pl15 pr15 pt10 pb10 bb-gray2">暂无信息</div>'}if(d.dataNum!=null){var h=Math.ceil(d.dataNum/12);if(h>1){a+='<div class="grid pl15 pr15 pt10 pb10 bb-gray3 bt-gray2"><div class="grid w100">'+'<div class="col-1 w40">'+'<button id="previousPage" type="button" class="button btn-yellow">上一页</button>'+'</div><div class="col-1 w20">'+'<select id="selectPage" onchange="changePage()">';var b=$condition["page"];for(var f=1;f<=h;f++){if(b==f){a+='<option id="quickPage" value="'+f+'" selected = "selected">'+f+"</option>"}else{a+='<option id="quickPage" value="'+f+'">'+f+"</option>"}}a+="</select>"+"</div>"+'<div class="col-1 w40">'+'<button id="nextPage" type="button" class="button btn-yellow">下一页</button>'+"</div>"+"</div></div>"}}$("#docPage").html(a);initPage(h);J.hideMask()}function initPage(a){$("#previousPage").tap(function(){if($condition["page"]>1){$condition["page"]=parseInt($condition["page"])-1;J.showMask();$.ajax({url:$requestDoc+setUrlCondition()+"&getcount=1",success:function(b){readyDoc(b);setLocationUrl();$("#findDoc_article").scrollTop(0)}})}else{J.showToast("已是第一页","","1000")}});$("#nextPage").tap(function(){if($condition["page"]<a){$condition["page"]=parseInt($condition["page"])+1;J.showMask();$.ajax({url:$requestDoc+setUrlCondition()+"&getcount=1",success:function(b){readyDoc(b);setLocationUrl();$("#findDoc_article").scrollTop(0)}})}else{J.showToast("已是最后一页","","1000")}})}function changePage(){$condition["page"]=$("#selectPage").val();$.ajax({url:$requestDoc+setUrlCondition()+"&getcount=1",success:function(a){readyDoc(a);setLocationUrl();$("#findDoc_article").scrollTop(0)}})}function setUrlCondition(){var a="";for($key in $condition){if($condition[$key]&&$condition[$key]!==""){a+="&"+$key+"="+$condition[$key]}}return a}function setLocationUrl(){var b={};var d="";var a="";for($key in $condition){if($condition[$key]&&$condition[$key]!==""){a+="&"+$key+"="+$condition[$key]}}a=a.substring(1);a="?"+a;var c=$requestDoctorSearch+a;history.pushState(b,d,c)};