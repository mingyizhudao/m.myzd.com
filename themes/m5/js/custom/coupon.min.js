$(function(){var domForm=$("#coupon-form"),btnSubmit=$("#btnSubmit");$.validator.addMethod("isMobile",function(value,element){var length=value.length;var mobile=/^(13[0-9]{9})|(18[0-9]{9})|(14[0-9]{9})|(17[0-9]{9})|(15[0-9]{9})$/;return this.optional(element)||(length==11&&mobile.test(value))},"请填写正确的手机号码");$("#WxCouponForm_mobile").on("click",function(){var container=$("#hongbao");var scrollTo=$(this);container.scrollTop(scrollTo.offset().top-container.offset().top+container.scrollTop());container.animate({scrollTop:scrollTo.offset().top-container.offset().top+container.scrollTop()})});btnSubmit.click(function(){domForm.submit()});var validator=domForm.validate({rules:{"WxCouponForm[mobile]":{required:true,isMobile:true,maxlength:11,},"WxCouponForm[verify_code]":{required:true,digits:true,maxlength:6,minlength:6},"WxCouponForm[coupon_code]":{required:true,maxlength:50}},messages:{"WxCouponForm[mobile]":{required:"请输入手机号码",isMobile:"请输入正确的中国手机号码!",maxlength:"请输入正确的中国手机号码!"},"WxCouponForm[verify_code]":{required:"请输入短信验证码",digits:"请输入正确的短信验证码",maxlength:"请输入正确的短信验证码",minlength:"请输入正确的短信验证码"},"WxCouponForm[coupon_code]":{required:"请输入劵码",maxlength:"请输入正确劵码"}},errorElement:"div",errorPlacement:function(error,element){element.parents("li").find("div.error").remove();element.parents("li").find("div.errorMessage").remove();error.appendTo(element.parents("li"))},submitHandler:function(){disabledBtn(btnSubmit);var actionUrl=domForm.attr("action");var formdata=domForm.serializeArray();domForm.ajaxSubmit({type:"post",url:actionUrl,data:formdata,success:function(data){if(data.status=="ok"){$("#hongbao").removeClass("active");$("#successHongbao").addClass("active")}else{domForm.find("div.error").remove();isfocus=true;for(error in data.errors){errerMsg=data.errors[error];inputKey="#WxCouponForm_"+error;$(inputKey).focus();if(error=="verify_code"){$(inputKey).parent().parent().after("<div class='error'>"+errerMsg+"</div> ")}else{$(inputKey).parent().after("<div class='error'>"+errerMsg+"</div> ")}}enableBtn(btnSubmit)}},error:function(XmlHttpRequest,textStatus,errorThrown){},complete:function(){enableBtn(btnSubmit)}})}})});