$(function(){$.validator.addMethod("isMobile",function(value,element){var length=value.length;var mobile=/^(13[0-9]{9})|(18[0-9]{9})|(14[0-9]{9})|(17[0-9]{9})|(15[0-9]{9})$/;return this.optional(element)||(length==11&&mobile.test(value))},"请填写正确的手机号码");var domForm=$("#booking-form"),btnSubmit=$("#btnSubmit");btnSubmit.click(function(){var bool=validator.form();if(bool){formAjaxSubmit()}});var validator=domForm.validate({rules:{"booking[id]":{},"booking[doctor_name]":{},"booking[hp_dept_name]":{},"booking[hospital_name]":{},"booking[contact_name]":{required:true},"booking[mobile]":{required:true,isMobile:true},"booking[verify_code]":{required:true,digits:true,maxlength:6,minlength:6}},messages:{"booking[id]":{},"booking[doctor_name]":{},"booking[hp_dept_name]":{},"booking[hospital_name]":{},"booking[contact_name]":{required:"请填写患者姓名",},"booking[mobile]":{required:"请填写手机号码",isMobile:"请输入正确的中国手机号码"},"booking[verify_code]":{required:"请输入验证码",digits:"验证码不正确",maxlength:"验证码不正确",minlength:"验证码不正确"}},errorElement:"div",errorPlacement:function(error,element){element.parents(".ui-field-contain").find("div.error").remove();error.appendTo(element.parents(".ui-field-contain"))}});function formAjaxSubmit(){disabledBtn(btnSubmit);var actionUrl=domForm.attr("data-action-url");var returnUrl=domForm.attr("data-return-url");var againUrl=domForm.attr("data-again-url");var formdata=domForm.serializeArray();var dataArray=structure_formdata("booking",formdata);var encryptContext=do_encrypt(dataArray,pubkey);var param={param:encryptContext};$.ajax({type:"post",url:actionUrl,data:param,success:function(data){console.log(data);if(data.status=="ok"){J.hideMask();location.href=returnUrl}else{if(data.status=="no"){domForm.find("div.error").remove();for(error in data.errors){var errorMsg=data.errors[error];var inputKey="#booking_"+error;$(inputKey).parents(".ui-field-contain").append("<div class='error'>"+errorMsg+"</div>");enableBtn(btnSubmit)}}else{if(data.status=="error"){J.hideMask();location.href=againUrl}}}},error:function(XmlHttpRequest,textStatus,errorThrown){enableBtn(btnSubmit);console.log(XmlHttpRequest);console.log(textStatus);console.log(errorThrown)}})}});